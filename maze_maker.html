<html>
<head>
	<!-- Import P5 -->
	<script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/0.6.0/p5.js"></script>
</head>
<body>
	<script type='text/javascript'>
		const CANVAS_SIDE_LENGTH = 800;
		const CANVAS_BUFFER = 50;
		const ISLAND_WIDTH = 80;
		const ISLAND_HEIGHT = 20;
		const ISLAND_BUFFER = 10

		const ISLANDS_PER_SIDE = 6;
		const ISLAND_COUNT = 20;

		const ISLAND_CELL_SIZE = (CANVAS_SIDE_LENGTH - CANVAS_BUFFER * 2) / ISLANDS_PER_SIDE;

		let islands;

		class Island {
			constructor(x, y) {
				this.x = x;
				this.y = y;
				this.neighbors = []
			}

			addNeighbor(island) {
				this.neighbors.push(island);
			}
		}

		function setup() {
			createCanvas(CANVAS_SIDE_LENGTH, CANVAS_SIDE_LENGTH);
			background('lightblue');

			islands = Array(ISLANDS_PER_SIDE).fill(undefined).map((_,i) => {
				return Array(ISLANDS_PER_SIDE).fill(undefined).map((_, j) => {
					var islandX = i * ISLAND_CELL_SIZE + CANVAS_BUFFER;
					var islandY = j * ISLAND_CELL_SIZE + CANVAS_BUFFER;

					return new Island(islandX, islandY);
				})
			})

			islands.forEach((islandRow, i) => {
				islandRow.forEach((island, j) => {
					var potentialNeighbors = []

					if (i > 0 && islands[i - 1][j] && islands[i-1][j].neighbors.length === 0) {
						potentialNeighbors.push(islands[i - 1][j]);
					}

					if (j > 0 && islands[i][j -1] && islands[i][j-1].neighbors.length === 0) {
						potentialNeighbors.push(islands[i][j-1]);
					}

					if (i < islands.length -1 && islands[i + 1][j] && islands[i+1][j].neighbors.length === 0) {
						potentialNeighbors.push(islands[i+1][j]);
					}

					if (j < islands.length - 1 &&islands[i][j +1] && islands[i][j+1].neighbors.length === 0) {
						potentialNeighbors.push(islands[i][j+1]);
					}

					if (potentialNeighbors.length > 0) {
						island.addNeighbor(potentialNeighbors[Math.floor(random(0, potentialNeighbors.length))])
					}

				})
			})
		}

		function draw() {
			drawBridges();
			drawIslands();
		}

		function drawBridges() {
			strokeWeight(5)
			stroke('brown')
			islands.forEach((islandRow) => {
				islandRow.forEach((island) => {
					island.neighbors.forEach((neighbor) => {
						line(island.x, island.y, neighbor.x, neighbor.y)
					})
				});
			});
		}

		function drawIslands() {
			noStroke()
			fill('khaki');
			islands.forEach((islandRow) => {
				islandRow.forEach((island) => {
					ellipse(island.x, island.y, ISLAND_WIDTH, ISLAND_HEIGHT)
				})
			});
		}

	</script>
</body>
</html>
